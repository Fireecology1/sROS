---
title: "Simple models for conifer surface fires"
author: "D. D. B. Perrakis S. W. Taylor"
Output:
  pdf_document: default
  word_document:
    fig_width: 6.3
    fig_height: 6.3
output:
  word_document: default
  pdf_document: default
bibliography: C:/Dan/Zotero/My library.bib
csl: "ecological-applications.csl"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,root.dir = 'c:/Dan/_Remote_projects/ccp-sROS')

#setwd("c:/Dan/_Remote_projects/ccp-sROS/files")

#.libPaths("C:/Dan/RPackages")

library(tidyverse)
library(broom)

#Get data frame, ready to query 
#Import data frame
fd <- read.csv('./files/fire_data_June2024.csv')  # with corrected SFC from McRae, Sharp p#16 to sharp.th, PNFI R5 MC.SA, Dewdrop SFC corrected

#FWI and moisture functions 
load(file='./files/wbmc5.rda')
load(file='./files/mcF.rda')
load(file='./files/ISI.rda')
load(file='./files/gr-cf.rda')

#set variables for modelling
fd4 <- mutate(fd, 
              CFI=CFI1, #lower CFI only for multi-story stands
              FSG=FSG1)  #same for FSG

#Deciduous data
d1.fires <- read.csv('./files/fire_data_d1_apr2024.csv')

#Combine conifer data with D1
fd.all <- bind_rows(fd4 %>% select(
  num:RH, Grass.Cure, Plot.Wd) %>%
    mutate(Date=ymd(Date)), 
  d1.fires %>% select(num:RH, Grass.Cure, Plot.Wd) %>%
    mutate(Date=ymd(Date)))  

```

## Abstract

Surface fire behaviour is the most frequent type of wildfire activity encountered during the fire season in conifer forests. Surface fire spread models can provide guidance under conditions less conducive to crown fire: low to moderate fire danger conditions or in forest stands with a high crown base. We used a database of conifer-dominated experimental surface fires to fit simple empirical models of rate of spread (ROS) under light-to-dense canopy stands that can be readily integrated within operational decision support systems. Final models include the Canadian Initial Spread Index (ISI) along with a stand-adjusted version (ISI~SA~) as predictors, along with estimated surface fuel consumption (SFC). While imprecise, these models are usually accurate enough (within +/- 2–4 m min^-1^) for many forecasting and fire management purposes.

### [Process - get SF data]

```{r label=site.indexes, echo=FALSE, message=FALSE}

#Index numbers for different sites
porters <- filter(fd4, str_detect(fire, "PORTER")) %>% pull(num)
sc <- filter(fd4, str_detect(fire, "PNFI SC")) %>% pull(num) #south corner fire is low dens.
pg.low <- filter(fd4, str_detect(fire, "PRINCE")) %>%
  filter(str_detect(fire, "# 4")) %>% pull(num)   #select shorter stands at PG site only
pg.high <- filter(fd4, str_detect(fire, "PRINCE")) %>% 
  filter(str_detect(fire, "# 1")) %>% pull(num)
kenshoe <- filter(fd4, str_detect(fire, "KENSHOE")) %>% pull(num)
sharp <- filter(fd4, str_detect(ExpProject, "Sharpsand IM")) %>% pull(num)  #original Sharpsand Immature stands only
sharp.th <- filter(fd4, str_detect(ExpProject, "Sharpsand TH")) %>% pull(num)
sharp.sm <- filter(fd4, str_detect(ExpProject, "Sharpsand SM")) %>% pull(num)
rp <- filter(fd4, str_detect(fire, "PNFI RP")) %>% pull(num)
darwin <- filter(fd4, str_detect(fire, "DARWIN")) %>% pull(num)  #1, 2, 6, 7 are  low density plots
darwin.low <- c(66, 67, 90, 91)
bigfish <- filter(fd4, str_detect(fire, "BIG FISH")) %>% pull(num)
icfme <- 77:87 #order is A, 1, 2, 3, 4, 5, 6, 7, 8a, 8b, 9; fixed in icfme process
icfme.hd <- c(77:79, 82:87)  #all but p3, p4
#archer <- 109:117
pelican <- 109:110  #Changed for Mar2023; was 123-124
#fpft <- c(119:122, 125:126)
dewdrop <- filter(fd4, str_detect(ExpProject, 'Dewdrop')) %>% pull(num)

#function to calculate isi.m
isi.mcsa <- function(mcsa, ws) {
  m=mcsa
  f_w= exp(0.05039*ws)
  f_f= (91.9*exp(-0.1386*m))*(1+(m^5.31)/(4.93*10^7))
  return(0.208*f_w*f_f)
}

#surface fires - extract all CFI1==0, calculate isi.m
s.fires <- mutate(rowwise(fd.all), 
                  isi.m=isi.mcsa(mc=MC.SA, ws=ws)) %>% #get ISI using MC.SA
  filter(CFI1==0) %>% 
  select(-CFI2) %>%
  mutate(FT=as.factor(case_when(
           str_detect(ExpProject, 'D1') ~ 'Decid',
           str_detect(ExpProject, 'Dewdrop') ~ 'PPDF',
           TRUE ~ 'Con'))
         ) %>%
  ungroup() %>% as.data.frame()
 
#Add FBP database missing VW fires: 2 C4, 2 C5
s.miss0 <- data.frame(num=122:125, 
                      fire=c('PNFI #1 13 yr ONT',
                             'PNFI #2 12 yr ONT',
                             'PNFI RW #1-41-2', 
                             'Carp Lk PNFI WF QC'),
                     CFI1=0, Fire.type='S', 
                     ROS=c(7.6, 4.3, 3, 7.5),
                     SFC=c(1.6, 0.59, 0.3, 0.9), #only 0.59 was meaasured
      #Estimated SFC for 3/4 obs: C4 est: 1.64 (BUI 57); C5 est: 0.28 (BUI 25), 0.85 (BUI 45)
                     CFC=c(0, 1.0, 0, 0), 
                     Date=c('1977-05-19', '1976-08-04', 
                            '1976-05-10', '1963-07-03') %>% ymd(),
      ws=c(19, 10, 18, 25),
      FFMC=c(91.7, 89.9, 90.4, 90.7), 
      ISI=c(14.2, 7, 11.2, 16.7), 
      DMC=c(57, 26, 20, 45), 
      DC=c(107, 276, 86, 81), 
      BUI=c(57, 42, 25, 45), 
      MC.SA_season=c(1, 2, 1, 2), 
      MC.SA_dens=2, 
      MC.SA_stand=4, 
      FT='Con', #all 4 considered pine stands (conifer type)
      ExpProject=c('PNFI (JP)', 'PNFI (JP)', 'PFNI (WRP)', 'PNFI (WRP)')) 

#with ISI.mcsa values for the first two C4 PNFI fires
s.miss <- mutate(rowwise(s.miss0), 
                 MC.SA=wbmc5(FFMC, DMC, MC.SA_stand, 
                             MC.SA_dens, MC.SA_season),
                 isi.m=isi.mcsa(mc=MC.SA, ws=ws)) %>%
  as.data.frame() 
  

s.fires2 <- bind_rows(s.fires, s.miss)
```

### [Proc. SF models and PPDF]

```{r label=sROS, echo=FALSE, message=FALSE, warning=FALSE}
#ROS models 

#original ccp (2019) sf formula
sros.st <- function(isi) {
  0.6308 + 0.056*isi + 0.0086*isi^2
}

#Original unaltered conifer SF only - excludes D1, PPDF fires
s.fires.con <- filter(s.fires2, FT=='Con') 

#conifer-only isi.mcsa^2 ROS model
con.lm.mod <- lm(data=s.fires.con, formula=ROS~I(isi.m^2)-1)

#conifer-only ISI^2 model
con.ISI.mod <- lm(data=s.fires.con, formula=ROS~I(ISI^2)-1)
#use for testing fuel type significance


#prediction function for simple lm using isi.m
sf.con.fun <- function(isim) {
  predict(con.lm.mod, newdata=list(isi.m=isim))
}

#Noted - fires with some torching seem to be anomalous
#Exceptions: fires with torching, CFC >1
except <- filter(s.fires, CFC > 0.2 | num==48) %>%
  mutate(FT='Torch')  #using this in fuel type variable for graphs

wildfires <- filter(s.fires2, num %in% c(68, 69, 76,
                                        125, 232)) %>%
  mutate(FT='WF')
#filter out fires with CFC; somewhat anomalous
#first convert all NA CFC values to 0
s.fires3 <- s.fires2 %>% 
  mutate(
    CFC=ifelse(num==48, 0.2, CFC),   #assume R3 torching
    CFC=ifelse(is.na(CFC), 0, CFC)) %>%
            filter(CFC <= 0.2)

#Curing and C7 fires
ppdf <- filter(s.fires3, num %in% dewdrop & !is.na(Grass.Cure))

c7.fullcuring <- 95  #
fc.cf <- gr.cf(c7.fullcuring)

#grass curing function
#0.5 actual ROS plus 0.5 of 'full curing' ROS if it was all grass
#mean(0.67, 0.47, 0.83)
#set SFC p8 to mean above

s.fires.mod0 <- s.fires3 

#fire 8 gets mean SFC from fires close to same time of yr, BUI
s.fires.mod0$SFC[which(str_detect(s.fires.mod0$fire, 'JOHNSON EXP FIRE 8'))] <- 
  sum(0.67, 0.47, 0.83)/3

s.fires.mod <- s.fires.mod0 %>%
  mutate(CF=gr.cf(curing=Grass.Cure),  #calculate curing factor
         ROS=ifelse(is.na(Grass.Cure), ROS,  #obs with no %C are unchanged
            ROS/2+ROS*fc.cf*(1/CF)/2))   
#ROS is half from original, half increased using inverse of curing factor

#So far these models involve - 
# - Cutting out data with CFC > 1
# - 'Detrending' PIPO fires to simulate high grass curing, half
# - including substantial percentage of D1 fires

#linear model using ISI^2
sros.ISI2.mod <- lm(ROS ~ I(ISI^2)-1, data=s.fires.mod)
#r^2=0.7217 with s.fires3
#r^2=0.692 with s.fires.mod

#wind speed squared only
sros.ws2.mod <- lm(ROS ~ I(ws^2)-1, data=s.fires.mod)

#lm using isi.m^2
sros.isim2.mod <- lm(ROS ~ I(isi.m^2)-1, data=s.fires.mod)
#r^2=0.708 with s.fires2
#r^2=0.7605 with s.fires.mod

#lm using isi.m AND SFC - best simple model overall
sros.isim2SFC.mod <- lm(ROS ~ I(isi.m^2) + sqrt(SFC)-1, 
                        data=s.fires.mod)
#r^2=0.75 with s.fires2
#r^2=0.8025 with s.fires.mod
#r^2=0.617 with s.fires.con


#similar model with ISI (sros.ISI2SFC.mod) is also good, but not as good
sros.ISI2SFC.mod <- lm(ROS ~ I(ISI^2) + sqrt(SFC) - 1, 
                       data=s.fires.mod)
#r^2=0.7501

#prediction functions
sf.lin.fun <- function(ws) {
  predict(sros.lin.mod, newdata=list(ws=ws))
}

#nls model and prediction function: ax^b format
sf.axb.isi.mod <- nls(data=s.fires.mod, formula= 
               ROS ~ a * ISI^b, start=list(a=1, b=2))

sf.axbisi.fun <- function(isi) {
  predict(sf.axb.isi.mod, newdata=list(ISI=isi))
}


#fake data for lines - isim2SFC / IsaSFC model; fros1 is at SFC=1.34, fros2 is at SFC=2
#also ISI2SFC model and 
f.sfires0 <- data.frame(fisim=seq(0:30), fsfc1=1.34, fsfc2=2)
f.sfires <-mutate(rowwise(f.sfires0),
              fros1=predict(sros.isim2SFC.mod, 
              newdata=list(isi.m=fisim, SFC=fsfc1)),
              fros2=predict(sros.isim2SFC.mod, 
              newdata=list(isi.m=fisim, SFC=fsfc2)))

#FBP/Van Wagner models:
c6s <- function(isi) {
  ros=30 * (1-exp(-0.08*isi))^3
  return(ros)
}

#vw 1993 surface model for c4 immature pine stands; changed to c4s
#sf.vw93i
c4s <- function(isi) {
 20*(1-exp(-0.2*isi))^5 
}

#vw 1993 surface model for c3 mature pine stands
#sf.vw93m
c3s <- function(isi) {
 15*(1-exp(-0.05*isi))^2 
}

#D1
#sf.d1 
d1 <- function(isi) {
  30*(1-exp(-0.0232*isi))^1.6 
}


#fit Chapman-Richards function to surface fire data
#This will be prediction model going forward
a.value <- 20 

sf.crisim.mod <- nls(data=s.fires.mod, formula= 
               ROS ~ a.value * (1-exp(-b*isi.m))^c, 
               start=list(b=0.08, c=3))


#just need to make a function from the model
sf.crisim.fun <- function(isim) {
  predict(sf.crisim.mod, newdata=list(isi.m=isim))
}
  
#Using ISI
sf.crisi.mod <-nls(data=s.fires.mod, formula= 
               ROS ~ a.value * (1-exp(-b*ISI))^c, 
               start=list(b=0.1, c=3))

#CR nls function using ISI
sf.crisi.fun <- function(isi) {
  predict(sf.crisi.mod, newdata=list(ISI=isi)) %>% unname()
}

#Conifer obs only!
###################
#recall con.lm.mod and con.ISI.mod
s.con <- s.fires.mod %>% filter(FT=='Con') #same as s.fires.con

sf.crisiCon.mod <-nls(data=s.con, 
                formula= 
               ROS ~ a.value * (1-exp(-b*ISI))^c, 
               start=list(b=0.1, c=3))

sf.crisiCon.fun <- function(isi) {
  predict(sf.crisiCon.mod, newdata=list(ISI=isi)) %>% unname()
}

#isi.m
sf.crisimCon.mod <-nls(data=s.con, 
                formula= 
               ROS ~ a.value * (1-exp(-b*isi.m))^c, 
               start=list(b=0.1, c=3))

sf.crisimCon.fun <- function(isim) {
  predict(sf.crisimCon.mod, newdata=list(isi.m=isim)) %>% unname()
}

#test for pine/spruce/other difference
s.con2 <- mutate(s.con, 
                 FT2=str_extract(ExpProject, "\\([^()]*\\)"), #all inside ()
                 FTsp=str_detect(FT2, 'S') %>% as.factor(),
                 FT3=case_when(
                   str_detect(FT2, '/') ~ 's',  #mix of pine /spruce
                   str_detect(FT2, 'S') ~ 's',  #spruce only
                   str_detect(FT2, '(JP)') ~ 'jp',         #jack pine only
                   TRUE ~ 'op') %>% as.factor())  #other pines
                 
#test for sig. of Fuel type factors
con.ft2 <- lm(ROS ~ I(ISI^2) + FTsp -1, data=s.con2) #NS
con.ft3 <- lm(ROS ~ I(ISI^2) + FT3 -1, data=s.con2) 
#FT3 is actually significant, with 'other pine sp' sig. lower ROS than jp
#testing contrast:
#emmeans_output <- emmeans(con.ft3, ~FT3)
#cld(emmeans_output, alpha=0.05, Letters=letters)
#shows op <> jp (op=s and s=jp though)

#summary(update(sros.ISI2SFC.mod, ~ I(ISI^2) + sqrt(SFC) + FT3 - 1, data=s.con2))
#SFC models are NS when applied to conifer-only dataset; Fuel type then also 
#becomes NS (P > 0.05)


#Add function for ISI2SFC and ISI.mSFC models
sf.isi2sfc.fun <- function(isi, sfc) {
  predict(sros.ISI2SFC.mod, newdata=list(ISI=isi, SFC=sfc)) %>% 
    unname()
}

sf.isim2sfc.fun <- function(isim, sfc) {
  predict(sros.isim2SFC.mod, newdata=list(isi.m=isim, 
                                          SFC=sfc)) %>%
    unname()
}

#SFC=0.75
sf.isim2sfc075.fun <- function(isim) {
  sfc_vals=rep(0.75, length(isim))  #required for stat_function
  predict(sros.isim2SFC.mod, 
          newdata=list(isi.m=isim, SFC=sfc_vals))
}

#SFC=1.5
sf.isim2sfc15.fun <- function(isim) {
  sfc_vals=rep(1.5, length(isim))  #required for stat_function
  predict(sros.isim2SFC.mod, 
          newdata=list(isi.m=isim, SFC=sfc_vals))
}

#SFC=3
sf.isim2sfc3.fun <- function(isim) {
  sfc_vals=rep(3.0, length(isim))  #required for stat_function
  predict(sros.isim2SFC.mod, 
          newdata=list(isi.m=isim, SFC=sfc_vals))
}

#Fernandes sf (Fernandes et al. 2009) model for 
#maritime pine stands based on ws, litter mc, fuel depth
#not clear what height for ws measurements...
sf.fernandes <- function(ws, mc, fd) {
  ROS=0.773*ws^0.707*exp(-0.039*mc)*fd^0.188
  return(ROS)
}

#Add ISI-FT and isim-FT models
# sf.nope <- nls(data=s.fires.mod %>% filter(FT=='Con'), 
#                ROS ~ 0.5*ws^a*exp(-b*MC.SA)^c, 
#                start=list(a=0.7, b=0.1, c=3))  #gives error

#All this stuff to try to do a Tukey test but it's almost all NS anyway
#only sig. difference is between PPDF and other 2 FTs (but screwy because of 
#the 'normalizing' to 95% curing)
s.fires.mod2 <- mutate(s.fires.mod, FT=as.factor(FT))

sf.ft <- lm(ROS ~ I(isi.m^2) + SFC + FT -1, 
              data=s.fires.mod2) #SFC NS
sf.ftim <- lm(ROS ~ I(isi.m^2) + FT-1, 
              data=s.fires.mod2) #SFC NS

sf.ftisi <- lm(ROS ~ I(ISI^2) + FT -1, 
              data=s.fires.mod2) #SFC NS

#Multiple comparisons - Tukey test
#try 'emmeans' package
# require(emmeans)
# require(multcomp)
# 
# emmeans_output <- emmeans(sf.ftim, ~ FT)
# 
# cld(emmeans_output, alpha = 0.05, Letters = letters)
#or
#contrast(emmeans_output, method = "revpairwise", adjust = "tukey")


```

### [Complex modelling attempts]

```{r fancy modeling attempts, echo=FALSE}


##Then try rpart models
rp.mods <-rpart::rpart(ROS ~ ., data=s.fires.mod %>% 
                  select(ROS, ws, FFMC, ISI, MC.SA, isi.m, SFC, FT),
                  method='anova')
#Hmmm. 

#leaps
#first make dataset with squared terms
s.fires.squared <- s.fires.mod %>%
  mutate(ws2=ws^2, 
         ISI2=ISI^2,
         isi.m2=isi.m^2,
         SFC2=SFC^2,
         SFC.sqrt=sqrt(SFC),
         ) %>%
  select(ROS, ws, ws2, FFMC, ISI, ISI2, MC.SA, isi.m, isi.m2, 
         SFC, SFC2, SFC.sqrt, FT, MC.SA_dens, DMC)

lp.mods <- leaps::regsubsets(ROS ~ ., 
                             data=s.fires.squared, force.out='DMC', 
                             nbest=1, nvmax=4)

best2 <- lm(ROS ~ isi.m2+FFMC-1, data=s.fires.squared)
#DMC factor was illogical, so excluded
#'exhaustive' search for all var combinations revealed models dominated by isi.m2; alone (1 var), with FFMC (2), with FFMC and ISI(3), or with FFMC, ISI, ws2 (4). Gains compared with isi.m2 model alone are very slight, suggesting overfitting. 

#All this effort to say that the best model includes isi.m probably alone as a squared term

#con dataset
s.fires.cosquared <- s.fires.con %>%
  mutate(ws2=ws^2, 
         ISI2=ISI^2,
         isi.m2=isi.m^2,
         SFC2=SFC^2,
         SFC.sqrt=sqrt(SFC),
         ) %>%
  select(ROS, ws, ws2, FFMC, ISI, ISI2, MC.SA, isi.m, isi.m2, 
         SFC, SFC2, SFC.sqrt, MC.SA_dens, DMC)

lp.mods.con <- leaps::regsubsets(ROS ~ ., 
                        data=s.fires.cosquared, force.out='DMC',
                             nbest=1, nvmax=4)  #DMC was bogus
#DMC estimate again negative, so excluded
#test MC.SA_season factor?

best2c <- lm(ROS ~ ISI2 + ISI -1, data=s.fires.cosquared) #no good


```

### [graphs and functions]

```{r label=graphs, echo=FALSE}

fig4 <- ggplot(s.fires.mod %>% filter(!is.na(SFC)), 
       aes(x=isi.m, y=ROS)) +  
  geom_point(aes(colour=FT, size=SFC), alpha=0.5) +    
  geom_point(data=s.fires3 %>% filter(!is.na(SFC)) %>% 
               filter(FT=='PPDF'), 
             aes(size=SFC), shape=21, color='darkgray', 
             fill='darkgray', alpha=0.5) +
  geom_point(data=wildfires, colour='black', fill='black', size=1, 
             shape=21) +
#  geom_line(data=f.sfires, aes(x=fisim, y=fros1), colour='gray')+
  stat_function(fun=sf.isim2sfc15.fun, color='purple', 
                linetype='dashed') +
#  stat_function(fun=sf.isim2sfc3.fun, color='red') +
  stat_function(fun=sf.crisim.fun, color='purple') +
  stat_function(fun=sf.crisimCon.fun, colour='pink') +
  theme_classic()
#  stat_function(fun=sf.con.fun, colour='gray') +
  #geom_text(x=28, y=sf.isim2sfc075.fun(28)+3, 
  #          label='IsaSFC') +
  

#fig4

#Graph with vw functions, ISI
fig5 <- ggplot(s.fires.mod %>% filter(!is.na(SFC)), 
       aes(x=ISI, y=ROS)) + 
  geom_point(aes(colour=FT, size=SFC), alpha=0.5) +    
  geom_point(data=s.fires3 %>% filter(FT=='PPDF'), aes(size=SFC), shape=21, size=4, fill='darkgray', alpha=0.5) +
  #geom_line(data=f.sfires, aes(x=fisim, y=fros1), colour='gray') + #IsaSFC model
#  stat_function(fun=sf.axbisi.fun, color='grey') +
  stat_function(fun=sf.crisi.fun, color='black') +
  stat_function(fun=sf.crisiCon.fun, color='gray') +  
  stat_function(fun=c4s, color='turquoise', linetype='dashed') +
  stat_function(fun=c3s, color='purple', linetype='dashed') +
  stat_function(fun=c6s, color='darkred') +
   # geom_text(x=21, y=c6s(21)-1, label='C6s') +
  theme_classic()

#fig5

```

## 1. Introduction

The rate of spread, or rate of forward advance, of a wildfire is probably its most important descriptive characteristic for fire managers [@VanWagner1965a; @Sullivan.Gould2020]. Fire behaviour in the conifer forests of Canada is often a story about crown fire – high intensity, rapidly spreading fires with flames overtopping the trees and ember spotting ahead of the front [@alexanderCrownFireDynamics2016]. And yet in the chronology of fire events, most days between ignition and extinction feature only ground or surface fire behaviour [@Wang.etal2014]. Surface fires can often be safely and routinely actioned by suppression crews and equipment [@wheatley2022], and managers need to be able to estimate the speed and intensity of fires even when crown fire activity is unlikely.

### Surface fire spread in the Canadian Fire Behavior Prediction System

Surface fire spread models have not been the primary focus of past Canadian fire behaviour modelling efforts, though they have made appearances. The present Fire Behavior Prediction System (FBPS) features fuel-type specific models encompassing the full range of surface through crown fire behaviour for a small number of conifer fuel complexes [@forestrycanadafiredangergroup1992a; @tymstra2010]. Thus, the majority of conifer ROS models do not discriminate between surface and crown fire behaviour but rather assume a gradual transition between fire types; a deliberate decision discussed by Van Wagner during the system's development [@vanwagner1989a]. However, more recent and flexible conifer modelling schemes exist that are specific in terms of the type of fire predicted under given weather and moisture inputs; these include CFIS (Crown Fire Initiation and Spread), Conifer Pyrometrics, and the forthcoming 'next generation' Fire Behavior Prediction System [@Alexander.etal2006a; @perrakis2020; @cfsfiredangergroup2021]. These models beg the question of what fire behaviour to expect (ROS, fire intensity, etc.) when crown fire behaviour is not predicted to occur. Pure surface fire models do exist in the FBPS for fuel complexes that do not exhibit crown fire behaviour: deciduous forests, open (treeless; i.e. grassland) communities, and scattered logging slash, in the form of the D-1, O-1 and slash (S-1 through S-3) fuel types, respectively [@forestrycanadafiredangergroup1992a]. As with the conifer fuel types, surface fire spread rate equations for these fuel types are based on the Chapman-Richards function [@vanwagner1989a]:

$$ROS=a(1-e^{-b\cdot ISI})^c$$ [1],

with the a, b, and c parameters assigned or fitted for each fuel type, and *ISI* representing the Initial Spread Index from the Fire Weather System [@vanwagner1987]. Newer models have also been developed for grass [@wotton2009d; @Kidnie.Wotton2015] and atlantic shrublands [@Pepin.Wotton2020]. A few models were previously published for predicting surface fire spread in conifer stands based on sparse observations at individual research sites [e.g., @Lawson1972], but these data were eventually incorporated into the broader-scope FBP fuel type functions.

### CE Van Wagner's surface fire models

As the FBP System was being developed, a more flexible theoretical dual equilibrium conifer crown fire model concept was proposed by CE Van Wagner. This involved a notional function describing the expected rate of spread of crown fires, RSC, as well as a separate function, RSS, representing "all possible surface fires"[@vanwagner1989a], with a crown fire initiation model representing the transition point between the two functions [@vanwagner1977a]. Suggested parameters for the RSS function appeared in the FBPS report in the form of the C-6s model, for the surface fire portion of the 'Conifer Plantation' fuel type: *a*=30, *b*=0.080, *c*=3; no explanation was provided as to the origin of these values [@forestrycanadafiredangergroup1992a]. Two additional sets of RSS parameters were published shortly thereafter, associated with surface fire spread in immature and mature jack pine stands in Ontario [@vanwagner1993a]. The immature stand was the source of many observations from the C-4 fuel type [@stocks1987b], with the following parameters ("C-4s"): *a*=20, *b*=0.20, *c*=5. Surface fire observations from mature pine stands associated with the C-3 fuel type [@stocks1989] were used to form another RSS model ("C-3S"): *a*=15, *b*=0.05, *c*=2. Again, no source was given for the origin of these parameters [@vanwagner1993a], and we presently assume they were derived by visual inspection from the limited underlying data. Figure 1 compares these notional conifer surface fire ROS models along with the D-1 model for comparison (*a*=30, *b*=0.0232, *c*=1.6). As the figure shows, as fire danger levels increase (i.e., higher ISI), predicted surface ROS predictions diverge widely between these models, with C3S and D1 curves predicting the lowest and the C4S predicting the highest values, respectively.

### [Fig1]

```{r label=Fig1, message=FALSE}

fig1 <- ggplot(data=s.fires, aes(x=ISI, y=ROS)) +
  stat_function(fun=c6s, colour='darkred') +
  stat_function(fun=c4s, colour='turquoise') +
  stat_function(fun=c3s, colour='purple') +
  stat_function(fun=d1, colour='green') +
  geom_text(x=10, y=c4s(10)+3, label='C-4s') +
  geom_text(x=15, y=c6s(15)-2, label='C-6s') +
  geom_text(x=26, y=d1(26)+1, label='D-1') +
  geom_text(x=24, y=c3s(24)-1, label='C-3s') +
  theme_classic() +
  labs(y='ROS (m/min)')
  

fig1

```

*Caption: Figure 1. Comparison of FBP System and associated fuel type surface fire rate of spread (ROS) models. D-1 and C-6S are described by Forestry Canada Fire Danger Group (1992). C-4S and C-3S refer to the surface fire models proposed by Van Wagner (1993) for immature and mature jack pine fires, respectively. ISI refers to the Initial Spread Index (Van Wagner 1987).*

### Objectives

The objective of this study was to use the Canadian database of experimental fires to produce simple and rapid models for estimating the ROS of surface fires burning beneath the canopy of conifer stands. Since fires in conifer stands spreading under higher danger conditions tend to be crown fires [@vanwagner1977a; @beverly2020; @cruz2022], the majority of surface fires involve occurred during moderate-level fire danger indices and wind speeds, or under higher danger conditions in stands with high crown base height (CBH; \> 6 m) in a few cases. Such models can be used to inform dynamic fire behaviour predictions sytems, where surface fire, crown fire initiation, and crown fire spread are modelled as separate but related processes [@scott2001; @perrakis2020a; @cfsfiredangergroup2021].

Previous studies have suggested that wind speed at the ground or flame height level is the most relevant and important predictor of ROS [e.g., @VanWagner1968; @catchpole1998]. However, this involves detailed studies of wind interactions with fuel structure, including edge effects [@moon2019; @schlegel2015], which is seldom available in operational situations. The present models therefore rely only on the standard 10 m open wind speed, as was measured in field experiments and is typically used for wildfire weather forecasts [@lawson2008]. This provides a suite of tools that is readily adapted to operational use, but is less accurate due to the significant influence of forest structure, including the effects of edges and openings on ground-level winds [@chen1999; @ma2010].

## 2. Methods

### Fire database

The source data for much of the FBPS, including the observations described above, is a slowly growing database of field-scale experimental burns conducted at various sites across Canada since the 1960s. These data have been previously described and analyzed [e.g. @alexander1990; @cruz1999a; @perrakis2023], but never before for the purpose of examining generalized surface fire models. The present database contains over 120 conifer observations of experimental fire behaviour in stands of \~0.1-4.0 ha (median size: 0.4 ha). All fires used in the present analysis were classed as surface fires in primary literature, though some nuances related to torching and passive crowning are discussed below.

In addition to the boreal conifer data, 32 experimental fire observations were available in deciduous stands. These were originally described by Alexander and Sando [-@Alexander.Sando1989], featuring fires from the US lake states, Quintilio et al. [-@quintilio1991], and Van Wagner [@vanwagner1973b]. A small number of experimental fires in Ponderosa pine- Douglas-fir (PPDF) stands in British Columbia were also included; these stands were structurally distinct from the boreal conifer sites and analyzed somewhat differently (see Box 1). Some models were fitted exclusively to the boreal conifer data, while the deciduous and PPDF data were included in other models in order to explore more generic tools for surface fire prediction across a range of Canadian forest types.

### Modelling and spread indices

Consistent with longstanding theoretical understanding of fire processes [@curry1940; @VanWagner1968; @Campbell-Lochrie.etal2021] and the majority of existing empirical models [@fernandes2009; @sullivan2009], we focused on wind speed and fuel moisture content as primary variables of interest. Our starting point for operational models was the aforementioned unitless *ISI* that combines empirical functions representing wind speed and fuel moisture influences in a power function [@vanwagner1987], as used in the Canadian FBP System [@forestrycanadafiredangergroup1992a]. Other variables of potential interest including fuel type and surface fuel consumption were also examined for significance. For modelling, we tested linear regression forms with linear and quadratic predictors, as well as sigmoidal and exponential non-linear forms.

In addition to the base ISI, we also explored a modification using a more recent and flexible fuel moisture estimate. We utilized the stand-adjusted moisture content (*mc~sa~*) model of Wotton and Beverly [-@Wotton.Beverly2007; see also @perrakis2023] that combines the effects of the FFMC and DMC indices along with stand type, density, and season for predicting the moisture content of dead litter. In order to leverage the additional flexibility of the *mc~sa~*, we calculated an alternative spread index, the stand-adjusted ISI (*ISI~sa~*). The ISI~sa~ involves the same ISI formulation as originally described but with the mc~sa~ value in place of the mc~FFMC~ [estimated fine fuel moisture content based on the FFMC; @vanwagner1987]. The full *ISI~sa~* equation is provided for completeness:

$$ ISI_{sa}=0.208\cdot (e^{0.05039\cdot ws}) \cdot (91.9 \cdot e^{-0.1386\cdot mc}) \cdot \left[ 1+\frac{mc^{5.31}}{(4.93\cdot 10^7)}) \right]  $$ [5], with *ws* representing the 10 metre open wind speed and *mc* representing mc~SA~ in this case.

To test for novel influences, we tested *ws*, *FFMC*, *mc~sa~*, *DMC*, *ISI*, *ISI~sa~*, *SFC*, fuel type, and stand density class predictor variables . We first calculated transformed terms for several of these: *ws^2^*, *ISI^2^*, *ISI~sa~^2^*, *SFC^2^*, and *sqrt(SFC)*, and tested all linear and quadratic variable combinations (1-4 predictors) using the 'leaps' package in R (ref#). We also tested for a non-linear response using the sigmoidal Chapman-Richards form previously described, as well as the nonlinear $a \cdot ISI ^{b}$ form. All analyses were performed in RStudio 2024.04 (Posit Software, Boston, MA, USA) with R version 4.2.1.

### Grass curing in PPDF fires

For the PPDF fires, we sought to incorporate grass curing effects into the analysis to account for the unique role of the herbaceous understory in these dry and open stands [@agee2006; @youngblood2008]. This involved normalizing all observations, following Cheney and Gould [-@cheney1995], to a nearly fully cured understory grass condition (95 % C). Although the grass biomass in these stands only represented a small fraction (\~3 %) of the total available surface fuel, we made the assumption that grass curing would be highly influential on ROS in these stands (#Beck 2003), perhaps as much as 50 % of the influence compared to a true grassland, due to its fine texture and well-aerated nature. The new adjusted 'fully cured' ROS (*ROS'*) was computed using the following equation:

$$ ROS'=\frac {ROS_0}{2} + \frac {ROS_0}{2} \cdot \frac {cf(95)} {cf(C)} ) $$[6], where *ROS~0~* represents the observed rate of spread with measured curing *C*, *cf(95)* represents the calculated curing factor at 95% C [@wotton2009] and *cf(C)* represents the curing factor of measured % C values (see Box 1). Moisture content of the remaining surface fuel complex of forest litter and woody debris were assumed to be unaffected by seasonal curing. *ROS'* values for these seven fires were then used in fitting the 'aggregate' model analyses, while PPDF fires were excluded from the boreal conifer models.

## 4. Results

#### Dataset description and types of fires

Our database of `r nrow(fd.all)` observations resulted in `r nrow(filter(fd.all, CFI1==1))` crown fires and `r nrow(fd.all %>% filter(CFI1==0))` surface fires. Among `r nrow(fd.all)-nrow(d1)` fires in conifer fuel types (surface and crown), a clear relationship is evident between fire type and rate of spread predicted by wind speed (Fig. 2).

### [Fig 2 simple ROS graph by fire type and eval for m25 and FBP mods]

```{r label=Fig2, echo=FALSE}
#Call all 'midstory passive crown fires' surface fires if
#CFC is less than 0.1
fd.ros0 <- mutate(fd4,
                 FiT2=case_when(
                   Fire.type=='PCM' & CFC < 0.1 ~ 'S',
                   Fire.type=='PCM' & CFC >= 0.1 ~ 'PC',
                   TRUE ~ Fire.type)) %>%
  select(num, fire, ws, ROS, ISI, SFC, FiT2)
  
fd.ros1 <- bind_rows(
  fd.ros0, s.miss %>% select(num, fire, ws, 
                        ROS, ISI, SFC, FiT2=Fire.type))

#remove wildfires - don't do this
fd.ros <- fd.ros1 
#%>%
#  filter(!num %in% c(68, 69, 76, 125))

#25% rule?
m25 <- function(x) {0.25*x}

fig2 <-ggplot(fd.ros, aes(x=ws, y=ROS, colour=FiT2))+
  geom_point(alpha=0.7)+
  xlim(0, 35)+
  stat_function(fun= m25, colour='black') +
  scale_colour_manual(values=c('red', 'orange', 'green')) +
  geom_smooth(method='lm', se=TRUE, level=0.95) +
  theme_bw() +
  labs(x='WS (km/h)', y='ROS (m/min)', colour='Type of fire')


#simple linear sROS model from graph:
sf.lin.ws <- lm(ROS ~ ws, data=fd.ros %>% filter(FiT2=='S'))

```

```{r label=m.25percent, echo=FALSE }

#get predictions for assigned function models:
#At this point, 65 obs from boreal conifer looks good
df.funs <- s.con %>%
#  fd.ros %>% filter(FiT2=='S') %>% 
  select(fire, ws, ISI, ROS) %>% 
  filter(!str_detect(fire, 'DEWDROP')) %>%
  mutate(num=row_number(),
         c3s = c3s(ISI),
         c4s=c4s(ISI),
         c6s=c6s(ISI),
         d1=d1(ISI),
         m25 = m25(ws)) %>%
  select(-c(fire, ws, ISI)) %>% select(num, everything()) #num then everything else


#spread data out for easy summarizing
df.funs.longer <- tidyr::pivot_longer(df.funs, 
                                      cols=c(ROS, c3s, c4s, c6s, d1, m25), 
                                      names_to='model', values_to='value')

fig2
```

*Caption: Figure 2. Overview of experimental burn observations by wind speed (WS), rate of spread (ROS) and type of fire showing simple linear trends. S, PC, and AC refer to surface, passive crown, and active crown fire behaviour types, respectively (Van Wagner 1977). The black line represents the '25 % model' for surface fire behaviour: ROS=0.25 \* WS.*

Surface fire ROS in conifer stands ranged from `r min(fd.ros$ROS)` – `r max(fd.ros %>% filter(FiT2=='S') %>% pull(ROS))` m min^-1^, with most fires' sROS values well below the maximum (95th percentile sROS of `r quantile(filter(fd.ros, FiT2=='S')$ROS, 0.95)` m min^-1^.). The fitted linear trend shown in Fig 2 (green line) represents a very simple, albeit weak, baseline linear surface ROS model for conifer observations (Model 1, n= `r fd.ros %>% filter(FiT2=='S') %>% nrow()` ):

$$ROS=-0.584 + 0.2459 \cdot WS_{10}$$

[1], with *P*\<0.01 and adjusted *R^2^* = 0.319. As indicated by the negative y-intecept, this model is limited to conditions where *WS~10~* \> 2.38 km h^-1^. Simple inspection suggests that a very simple arithmetic model, similar to Model 1, would result from the 0.25 *WS~10~* function (Figure 2, black line). Therefore, a rough but easily calculated approximation of surface fire ROS in conifer stands, in m min^-1^, can be estimated by 1/4 of the 10 m open wind speed in km h^-1^.; this is termed the '25% model' hereafter.

### Initial data exploration and model building

Figure 3 shows the ROS of surface fires classified by fuel type and surface fuel consumption level, displayed by ISI value, along with the next set of fitted models. Despite identifying these fires as surface fires in primary sources, a few observations appeared anomalous; a closer examination identified several fires with significant estimated levels of canopy fuel consumption (CFC). Fires with estimated CFC \> 0.2 kg m^-2^ (mean CFC: 0.35 kg m^-2^; highlighted in Figure 3) were then removed from the surface model-fitting, as these fires were considered transitional to passive crown fire and not representative of typical surface fire spread. Other questionable inclusions included non-boreal forest types, including PPDF fires noted previously as well as the few included wildfire observations.

The simplest ISI-based model fitted to the boreal and sub-boreal conifer observations was another linear model, with deciduous and PPDF fires excluded (Model 2: n=56):

$$ ROS=-1.769 + 0.486 \cdot ISI $$

[7]. This model had an adjusted *R^2^* of 0.459. As with Model 1, this model predicts illogical results (ROS \< 0) at low ISI values, with ROS=0 predicted when *ISI*=3.64. Figure 3 also shows a model forced through the origin and with an *ISI^2^* term, a much better fit (Model 3). Deciduous and PPDF fires are shown in the figure but were not included in dataset for fitting these models.

### [Fig3]

```{r label=Fig3, echo=FALSE}
#Show data, exceptions (CFC >0.1), PPDF orig. 
s.fires4 <- s.fires3 %>%
  mutate(
                 FT2=str_extract(ExpProject, "\\([^()]*\\)"), #all inside ()
                 FTsp=str_detect(FT2, 'S') %>% as.factor(), #T/F spruce
                 FT3=case_when(
                   str_detect(FT2, '/') ~ '2.s',  #mix of pine /spruce
                   str_detect(FT2, 'S') ~ '2.s',  #spruce only
                   str_detect(FT2, '(JP)') ~ '1.jp',         #jack pine only
                   str_detect(FT2, 'PPDF') ~ '5.ppdf',  #dewdrop ppdf
                   str_detect(FT2, 'D1') ~ '4.dec', #D1 stands
                   str_detect(FT2, 'P') ~ '3.op') %>% #should cover other pines
    as.factor())

Fig3 <- ggplot(s.fires4 %>% 
                 filter(!is.na(SFC)), 
       aes(x=ISI, y=ROS)) +  
  scale_colour_manual(values=c(
    'red3',
    'orange2',
    'yellow3', 
    'darkgreen',
    'turquoise4',
    'darkorchid4')) +
  geom_point(aes(colour=FT3, size=SFC), alpha=0.6) +    
  geom_point(data=except, aes(colour=FT, size=SFC), shape=22) +
  geom_point(data=wildfires, colour='black', fill='black', size=1, 
             shape=21) +
#  geom_point(data=ppdf, aes(size=SFC), shape=21) +
  stat_smooth(data=s.fires.con, method=lm, formula=y~I(x^2)-1, 
              se=FALSE, colour='black') + #same as sros.isi2.mod   
  stat_smooth(data=s.fires.con, method=lm, 
              formula=y~x, se=FALSE, colour='gray') + #linear fit
  stat_function(fun=d1, colour='green3', size=1.2) +
  theme_bw() +
  #theme(legend.position='none') +
  labs(y='ROS (m/min)', colour='Fuel Type & Torching')
  
  
Fig3

sf.lin.isi <- lm(ROS~ISI, data=s.fires.con)
#need to create linear ISI model like in graph and add to acc.tab4

```

*Caption: Figure 3. Fire observations showing rate of spread (ROS) by ISI. Colours indicate fuel type and fire characteristics as follows: jp- jack pine; s- black spruce or pine-spruce mix; op- other pine; dec- deciduous; ppdf- ponderosa pine-Douglas-fir; Torch- torching or passive crown fire behaviour (removed from surface analysis). Size indicates relative surface fuel consumption. The lines represent linear (Model 2: gray) and quadratic (Model 3: black) models fitted to conifer observations (jp, s, op), and the FBP D-1 model (green).*

```{r label=DewdropLargeWFC, echo=FALSE, warnings=FALSE}
#difference between Stocks' sites and Dewdrop:
stockssfc <- filter(fd.all, num %in% c(sharp, kenshoe)) %>%
  filter(num !=40 & num !=24) %>% pull(SFC)

stocks.lwfc <- c(
0.049,
0.042,
0.086,
0,
0.047,
0.01,
0,
0,
0.231,
0.045,
0.074,
0.132, #end Kenshoe
  0.037,
0.024,
0.047,
0.085,
0.259,
0.153,
0.345,
#0.345,  #no duplicating p11
0.34,
0.374,
0.488,
0.061,
0.223  #end sharpsand
)

#large WFC proportion
stocks.prop <- stocks.lwfc/stockssfc

#Dewdrop burns - need to add 
dewdrop.lwfc <- c(
1.139,
0.061,
0.681,
1.545,
0.693,
2.188,
3.892
)

dewdropsfc <- filter(fd.all, num %in% dewdrop) %>%
  filter(num !=120)  %>% #filter out 1980 burn, no info
  pull(SFC) + dewdrop.lwfc

#large wfc proportion
dewdrop.prop <- dewdrop.lwfc/dewdropsfc

#Wilcoxon rank-sum test (Mann-Whitney U-test)
prop.data <- data.frame(LWFC.prop=c(
  stocks.prop, dewdrop.prop),
            site=as.factor(
            c(rep(1, times=length(stocks.prop)),
              rep(2, times=length(dewdrop.prop)))))
                        
# wilcox.result <- prop.data %>%
  # with(wilcox.test(LWFC.prop ~ site)) 
# W=9, p-value=0.0004296
                                       
                                       
```

The influence of conifer fuel type was first tested using the *ISI^2^* form of Model 3. Only one surface fire observation was in a black spruce (BS) stand while five were in mixed jack pine- black spruce stands (JP-BS), 19 in pure jack pine (JP), and 26 in stands dominated by other pine species (OP). OP observations included lodgepole (*P. contorta*), red (*P. resinosa*), and white pine (*P. strobus*)-red pine stands. Fuel type was a significant variable in this model; however, the only significant contrast was between OP and JP stands, with OP fires exhibiting slightly slower ROS compared with JP fires (Fig. 3).

### [Box 1] Fires in Ponderosa Pine-Douglas-fir stands in BC

Seven\* experimental fires were conducted in Ponderosa pine-Douglas-fir forest stands in the Dewdrop Range near Kamloops, British Columbia, in 1978 and 1979. These fires were documented in two theses, by Nyberg[-@Nyberg1979] and Smaill [-@Smaill1980]. Summary fire weather and behaviour information were incorporated into the FBP System C-7 fuel type (FCFDG 1992), along with descriptive photos [@DeGroot1993]. Despite their obscurity, these experiments remain valuable and seldom replicated. In the FBP System, surface fuel consumption (SFC) was reported for only one of the burn experiments (Plot 9, burned on 17 September 1978), with a very high (possibly suspect) estimate of \> 5 kg m^-2^ of woody fuel consumption and total SFC of 5.3 kg m^-2^, the highest of any experimental fire to our knowledge in Canada.

Original copies of these documents were located and the surface fuel consumption and grass curing values were analyzed. Stand structure consisted of open forests of Ponderosa pine and Douglas-fir, with mostly herbaceous understory structure; mean canopy closure was 27.2 % (Nyberg 1979). Litter and duff cover were described as patchy to nonexistent.

The original SFC estimate for Plot 9 included consumption of all downed woody fuels, including from large diameter coarse woody debris (CWD; \> 7.6 cm). Although this is methodologically consistent with other FBP experimental burns (e.g., Stocks 1987, 1989), it appears to skew results due to the high contribution from CWD at Dewdrop. For instance, the contribution to SFC of CWD at Kenshoe Lake and Sharpsand Creek ranged from 0 to 22 % (mean: 9.2 %; cf. Stocks 1987, 1989). In contrast, at Dewdrop, the proportion ranged from 11 to 77 % (mean: 50.2 %), a highly significant difference (Mann-Whitney U-test: p \< 0.001). The cause of the difference can be explained by both higher seasonal drought conditions during the Dewdrop burns (mean Drought Code: 394 at Dewdrop vs 111 at Kenshoe Lake and 161 at Sharpsand; see Van Wagner 1987 for Drought Code calculations), and probably the overall frequency of larger diameter trees at Dewdrop (\> 17 % of trees in the '\>25 cm' DBH class; cf. Nyberg 1979); compared with other experimental burn sites (e.g., \~ 1 % of trees in the '\> 23 cm' DBH class at Kenshoe Lake ('White River'); @walker1975). This would result in higher pre-burn loading (both absolute and proportionally) from CWD at Dewdrop compared with the boreal sites.

Including contributions from large diameter logs in surface fires is at odds with current understanding of flame front dynamics. Consumption studies suggest that most CWD consumption occurs during post-frontal smoldering rather than during flaming combustion [@monsanto2008; @brown2003]. The high SFC at Dewdrop from CWD therefore skews results considerably for the PPDF fires. To compensate, new SFC values at Dewdrop were calculated excluding the CWD contribution. Including only consumption from herbaceous matter, litter, duff, and woody debris up to 7.6 cm in diameter resulted in new SFC values for Plots 1-6 (0.47 – 1.39 kg m^-2^), and a recalculated (notably lower: 2.01 kg m^-2^) value for Plot 9.\*\*

Another feature of interest from the documentation was the summer weather pattern and understory condition during these fires. As Nyberg [-@Nyberg1979] described, the 1978 season was unusually moist in the Kamloops area, including measurable rainfall received at the Dewdrop site nearly every week from April through end of August - an unusual occurrence in this very dry climate. Consequently, understory vegetation remained relatively green (uncured) for the six experimental burns. Relative proportions of live and dead grass and forb biomass were used to calculate percent curing values (% C) in the same manner as used in Australian and Canadian grass fire models [@cheney1998; @wotton2009b]:

$$C = \frac {GB_D} {(GB_D + GB_L)} \cdot 100
$$ [B1], where *C* is the percent curing (as per FCFDG 1992), and *GB~D~* and *GB~L~* represent dead and live grass and forb biomass (g m^-2^), respectively. Using mean values from experimental and control plot sampling on each given date (Nyberg 1979) gave *C* values of 56-66 % for Plots 1-6. For Plot 9, the reported values are unfortunately less explicit between live and dead biomass [@Smaill1980] and the above formula could not be used. Based on the date (17 September) and slightly lower overall grass moisture value [22.7 %; @Smaill1980], % C for that plot was estimated at 85%.

These analyses allowed us to include the Dewdrop experimental fires in our surface fire models, even though they stood apart from the primarily boreal conifer and dediduous experiments.

\*Plot numbers 1–6, burned in 1978, are described by Nyberg (1979). Plot 9, burned in 1979, is described by Smaill (1980). Plot 8 from the same site was apparently burned in 1980, but no further notes or details have been located.

\*\*SFC estimates represent the differences between pre-burn and post-burn fuel loading, including contributions from woody fuels, grasses and forbs, and litter (the site featured negligible duff quantities). Estimating litter consumption values required an estimate of pre-burn litter depth, which was not reported but was instead taken from Ducherer et al. [-@ducherer2009], a series of experiments at the same site (mean litter depth from control sites across all years and canopy positions: 3.3 cm).

[end Box 1]

Further model testing included the terms and predictor combinations previously noted. Most model forms using more than one or two predictors were non-significant owing to the modest sample size and high variability. The best results were obtained using combinations with *ISI* or *ISI~sa~* as squared terms or in non-linear model forms; these were forced through the origin due to the known lack of fire spread potential during high moisture conditions (e.g. ISI \< 2) and in order to produce models usable across the full range of possible wildfire conditions; i.e., ISI/ISI~sa~ values of 0 – 20 or more.

### [Table 1: Model summary]

```{r Mod sum table, echo=FALSE}
#Model list

#add sros.st, 
mod.list.long <- list(sf.lin.ws,
              sf.lin.isi,
              con.ISI.mod,
              con.lm.mod,
              sros.ws2.mod,
              sros.ISI2.mod,
              sros.ISI2SFC.mod,
              sros.isim2.mod,
              sros.isim2SFC.mod,
              sf.crisi.mod,
              sf.crisim.mod,
              sf.axb.isi.mod,
              sf.crisiCon.mod,
              sf.crisimCon.mod,
              c3s,
              c4s, 
              c6s,
              d1,
              m25)

modnames <-c('wslin.con',
             'isilin.con',
             'ISI2.con',
              'isim2.con',
              'WS2.agg',
              'ISI2.agg',
              'ISI2SFC.agg',
              'isim2.agg',
              'isim2SFC.agg',
              'crisi.agg',
              'crisim.agg',
              'axb.isi.agg',
              'crisi.con',
              'crisim.con',
             'c3s', 'c4s', 'c6s', 'd1', '25 perc') #last 5 are functions

#models only (not functions)
mod.list <- mod.list.long[1:(length(mod.list.long)-5)]

#formulae from model list
formulae <- lapply(mod.list, FUN=formula) %>% 
  as.character() %>%
  str_extract(pattern="~(.*)") %>% #keep everything right of the tilde
  str_remove('~ ') %>% #get ride of the tilde
  append(c(  #add the manual and Van Wagner models at the end
    '15 * (1-exp(-0.05*ISI))^2', #c3s
    '20 * (1-exp(-0.2*ISI))^5', #c4s
    '30 * (1-exp(-0.08*ISI))^3', #c6s
    '30 * (1-exp(-0.0232*ISI))^1.6', #d1
    '0.25 * ws')) #m25 model

#generate table of evaluation metrics
#MAE, MAPE, MSE
acc.table2 <- rcompanion::accuracy(mod.list) %>% 
  as.data.frame() %>%
  mutate(num=1:length(mod.list))

#get AIC, num of obs - repeat glance function across all models
acc.glance <- lapply(mod.list, broom::glance)

#pull nobs and AIC from glance operation
acc.glance2 <- lapply(acc.glance, `[`, c('nobs', 'AIC' )) %>%
  list_rbind() %>% round(1) %>%
  mutate(num=1:length(acc.glance))

#metrics for pre-determined model functions:
#mae.manual(actual=df.m25$ROS, pred=df.m25$pred25) # etc.
load(file='./files/mae.rda')
load(file='./files/mape.rda')
load(file='./files/Efr2.rda')

#calculate some metrics for m25 and the FBP model functions:
#FBP/VW models
df.eval <- df.funs.longer %>% group_by(model) %>%
    summarize(MAE=mae.manual(actual=df.funs$ROS, pred=value) %>% round(2),
              MAPE=mape.manual(actual=df.funs$ROS, pred=value) %>% round(2),
              ER2=ef.r.squared(actual=df.funs$ROS, pred=value) %>% round(2)
              ) %>%
  filter(model != 'ROS') %>%
  mutate(num=15:19,nobs=NA, RMSE=NA) %>%
  rename(Model=model)

#combine the two column groups, two evaluation tables, clean up
acc.table3 <- left_join(acc.glance2, acc.table2, 
                        by='num') %>%
  mutate(Model=modnames[1:(length(modnames)-5)]) %>%
  rename(MAE=Fit.criteria.MAE,
         MAPE=Fit.criteria.MAPE,
         RMSE=Fit.criteria.RMSE,
         ER2=Fit.criteria.Efron.r.squared
        ) %>%
  select(num, Model, nobs, RMSE, MAE, MAPE, ER2, AIC) %>%
  #add FBP and m25 metrics
  bind_rows(df.eval)

#ROS table at ISI (ISIm)=5, 10, 15
isi.vals=c(5, 10, 15)
ffmc.val=91
ws.vals=c(1, 14, 22)
mod.order.isim<- c(1, 4, 7, 10)

#create blank list
pred.list <- vector('list', length(mod.list))
names(pred.list) <- modnames[1:(length(modnames)-5)]

for (i in seq_along(mod.list)) {  #predict all mods in mod.list
  pred.list[[i]] <- predict(mod.list[[i]], 
                            newdata=
                              data.frame(ISI=isi.vals,
                                        isi.m=isi.vals,
                                        FFMC=ffmc.val,
                                        ws=ws.vals,
                                        SFC=1.5))
}

pred.df <- data.frame(ISI=isi.vals, pred.list) %>%
  mutate_all(round, 2)

#transpose
pred2.df <- as.matrix(pred.df) %>% 
  t() %>% as.data.frame() %>%
  mutate(Model=colnames(pred.df)) %>%
  slice(2:ncol(pred.df)) %>%
  select(Model, everything())

row.names(pred2.df) <- NULL
colnames(pred2.df)[2:4] <- c('ISI.5', 'ISI.10', 'ISI.15' ) 

#get c6, c4s, c3s d1 predictions
#ws vals at FFMC 91: 0.2162, 13.972, 22.019
ws.vals <- c(0.2162, 13.972, 22.019)

v1 <- c3s(isi.vals)
v2 <- c4s(isi.vals)
v3 <- c6s(isi.vals)
v4 <- d1(isi.vals)
v5 <- m25(ws.vals)

v15vals <- data.frame(v1, v2, v3, v4, v5) %>%
  as.matrix %>% t() %>%
  as.data.frame()

#A lot of effort to make a table of predictions at 3 values, but it works
predAdd.df <- data.frame(Model=df.eval$Model, 
                         ISI.5=v15vals[,1] %>% round(2),
                         ISI.10=v15vals[,2] %>% round(2),
                         ISI.15=v15vals[,3] %>% round(2))

pred3.df <- rbind(pred2.df, predAdd.df)

acc.tab4 <- left_join(pred3.df, acc.table3, by='Model') %>%
  mutate(Num=1:max(nrow(pred3.df), nrow(acc.table3)),
         Formula=formulae) %>%
  select(Num, Model, Formula, nobs, everything(), -num)

######################
#write.csv(acc.tab4, 'acc_table.csv')

#extra table for SFC-based models
sfc.names <- rep(c('ISI2SFC.agg', 'isim2SFC.agg'), each=4)
sfc.levels <- c(0.7, 1.5, 3, 5)

#sf.isi2sfc.fun and sf.isim2sfc.fun - calc ROS for 3 ISI vals, 4 SFC vals
sfc.isivals <- mapply(FUN=sf.isi2sfc.fun, isi=rep(isi.vals, 4), 
                 sfc=rep(sfc.levels, each=3)) %>%
  matrix(nrow=4, ncol=3, byrow=TRUE) %>%  #calculate ROS for each
  as.data.frame() 
colnames(sfc.isivals) <- c('ISI.5', 'ISI.10', 'ISI.15')

sfc.isimvals <- mapply(FUN=sf.isim2sfc.fun, 
                       isim=rep(isi.vals,4),
                sfc=rep(sfc.levels, each=3)) %>%
  matrix(nrow=4, ncol=3, byrow=TRUE) %>%
  as.data.frame()
colnames(sfc.isimvals) <- c('ISI.5', 'ISI.10', 'ISI.15')

#combine df for both models
sfc.allvals <- rbind(sfc.isivals, sfc.isimvals) %>%
  round(2)

ex.sfc.tab <- mutate(sfc.allvals, 
                     Model=sfc.names, 
                     SFC=rep(sfc.levels, 2),
                     num=1:8) %>%
  select(num, Model, SFC, everything())

#####################################
acc.tab4

```

*Caption: Table 1. Model forms and evaluation metrics for the fitted sROS models. Formulae include variables representing 10-metre wind speed (WS), initial spread index (ISI), stand-adjusted ISI (ISI~sa~), and surface fuel consumption (SFC, kg m^-2^). ISI/ISI~sa~ columns represent predicted ROS (m min^-1^) for given models at each predictor level. Constants used in calculations include FFMC 91 (Models 1, 5, 19), and SFC of 1.5 kg m^-2^ (Models 7 and 9). Evaluation metrics include root mean squared error (RMSE), mean absolute error (MAE), mean absolute percentage error (MAPE), Efron's R-squared (ER2), and Akaike's Information Criterion (AIC). Predefined functions (not fitted) include C-3S, C-4S, C-6S, D-1, and M25, which were evaluated against the 65 conifer fire observations.*

### Final fitted models

Table 1 shows the predictors and evaluation metrics for the list of fitted models, as well as *ROS* predictions at three levels of *ISI* or *ISI~sa~* (5, 10, 15). Other variables (FFMC, SFC) were assigned constant values where needed for calculation purposes, as noted. Also shown are evaluation results using the previously described Van Wagner and FBP surface fire models. As the table indicates, the datasets used varied from `r min(acc.tab4$nobs, na.rm=T)` to `r max(acc.tab4$nobs, na.rm=T)` observations. Models using the SFC predictor excluded observations without estimated SFC, resulting in slightly smaller datasets. 'Aggregated data' models included all surface fire observations except those with canopy fuel involvement, as noted previously. This includes fires in deciduous stands of aspen (29 observations), oak (2), or mixedwood (1) as well as seven PPDF fires (Box 1); wildfires were also retained. Boreal conifer models used only fires in jack pine, black spruce, jack pine/black spruce, red pine, lodgepole pine, and red pine/white pine [see @perrakis2023]. Models 2–4 included all such fires, while models 5–14 excluded fires that exhibited more significant torching, as noted.

Models forms 1–4 and 13–14, using the boreal conifer observations, had slightly better performance (higher Efron's r-squared, lower MAE and MAPE) than models fitted to the larger aggregated dataset (Models 5 – 12). Non-linear model forms using the sigmoidal Chapman-Richards form had insufficient data to automatically fit the *a* parameter ('nls' function failed to converge); *a* was set to 20 following the value for Van Wagner's C-4S model (Van Wagner 1993), an intermediate value between the low (15: C-3S) and high (30: C-6S, D1) choices. With the *a* parameter assigned, the remaining parameters were fitted to the data, producing relatively high-performing models, particularly those using the boreal conifer dataset with torching fires removed (Models 13, 14: Efron's R-squared \> 0.7, MAE \< 0.7 m min^-1^). In contrast, when using the broader aggregated dataset, the best performance included ISI~sa~ and SFC predictors (Model 9: Efron's R-squared of 0.664, MAE \<1 m min^-1^).

The evaluation measures in Table 1 show how the Van Wagner and FBP surface fire functions, as well as the '25%' model, compare to the fitted models for precting ROS of the boreal conifer data. High MAE and MAPE values, and negative values for Efron's R-squared, suggest very poor performance by the C-4S (especially) and C-6S models compared to the fire observations. The C-3S, D1, and 25% models, in contrast, are in the lower end of the range of model performance, but otherwise exhibit acceptable performance.

### [Table 2: Extended SFC predictions]

```{r Table 2, echo=FALSE}
ex.sfc.tab
```

Table 2 shows extended ROS predictions for the two models with *ISI* (or *ISI~sa~*) and *SFC* predictors. Both models were fitted with a *sqrt(SFC)* term, which performed slightly better (*ISI*: adjusted R^2^=`r summary(sros.ISI2SFC.mod)$adj.r.squared %>% round(4)`); *ISI~sa~*: adjusted R^2^=`r summary(sros.isim2SFC.mod)$adj.r.squared %>% round(4)`) than an untransformed *SFC* term (*ISI*: `r summary(update(sros.ISI2SFC.mod, ~.-sqrt(SFC) + SFC) )$adj.r.squared %>% round(4)` ; *ISI~sa~*: `r summary(update(sros.isim2SFC.mod, ~.-sqrt(SFC) + SFC) )$adj.r.squared %>% round(4)` , respectively). As the table values indicate, the influence of SFC was highest at low *ISI* (or *ISI~sa~*) values, and diminished under higher ISI conditions.

### [Figure 4 and diagnostics]

```{r label=Fig4, echo=FALSE}
#Do nlstools jackknife resampling to identify overly influential obs
#do this on crisiCon, crisimCon, 

jack.crisiCon <- nlstools::nlsJack(sf.crisiCon.mod)
#summary(jack.crisiCon)
jack.crisimCon <-nlstools::nlsJack(sf.crisimCon.mod)
#summary(jack.crisimCon)
#crisiCon: rows 10, 28, 49, 51 (s.con2)
#crisimCon: rows 10, 28, 51
#num: 20, 68, 122, 125

#for lm models, use broom::augment to run Cook's D
#high influence: D >1, or 0.5, or 4/n
cook.isim2sfc <- broom::augment(sros.isim2SFC.mod)
cook.ISI2sfc <- broom::augment(sros.isim2SFC.mod)

#cook.isim2sfc %>% top_n(.cooksd, n=10) %>% arrange(desc(.cooksd))
#cook.ISI2sfc %>% top_n(.cooksd, n=10) %>% arrange(desc(.cooksd))
#isim2sfc: rows 52, 28, 88, 60
#num: 117, 68, 232, 204
#ISI2sfc: rows 58, 28, 88, 59, 60

#model labels
lab1 <- 'M8' #change to dynamic label 
lab2 <- 'M10'
lab3 <- 'M13'  #crisim.con


fig4 +
  geom_text(x=23, y=sf.isim2sfc15.fun(23)+1, label=lab1, 
            colour='purple', size=4) +
  geom_text(x=24, y=sf.crisim.fun(24)-1, label=lab2,
            colour='purple') +
  geom_text(x=19, y=sf.crisimCon.fun(19)+1, label=lab3,
            colour='pink') +
  labs(x=expression(ISI[sa]), y='ROS (m/min)', size=expression(SFC~(kg/m^{2})), 
       colour='Fuel type') +
  theme(legend.position='none')
  
```

*Caption: Figure 4. Surface fire rate of spread (ROS) observations and selected fitted models, using the stand-adjusted initial spread index (ISI~sa~). Colours indicate fuel type (red: boreal conifer; blue: adjusted ponderosa pine-Douglas-fir (PPDF); green: deciduous; gray: original PPDF (not modelled)). Size indicates surface fuel consumption. Observations with black centres are documented wildfires; the remainder are experimental fires.*

Figure 4 shows the surface ROS observations plotted by overall fuel type (boreal conifer, deciduous, or PPDF) and SFC against *ISI~sa~*, along with three of the fitted models: M8 (calculated at SFC=1.5 kg m^-2^), M10, and M13 (boreal conifer only). PPDF fires adjusted to 95% curing conditions were used in model fitting, while the original observations (not included in models) are shown in grey. Observations with a black centre are wildfires; the remainder represent experimental fires.

#### Influential observations

Individual observations were evaluated for undue influence in the best models using Cook's Distance for linearized models (Models 5 and 7#) and jackknife resampling for non-linear models ('nlstools' R package, v2.1; @baty2015). For non-linear models 11 and 12#, observations were flagged when the difference between model parameters calculated with and without individual estimates, $\Delta$, was $\Delta>\frac {2 s} {\sqrt{n}}$, where *s* is the standard error of the parameter estimate and *n* is the sample size [@baty2015]. For linearized models, observations with Cook's D \> 0.1 were flagged as most concerning. High influence observations are shown in Figures 4 and 5 (#to do), consisting generally of high *ISI*/*ISI~sa~* and high ROS observations, particularly wildfires. Due to the shortage of data at high fire danger conditions, there is no way of removing these observations without significantly diminishing the usable range of these models. However, primary source descriptions that exist for these fires [i.e., @vanwagner1965b] suggest low confidence in these observations, unsurprisingly.

### [Fig 5]

```{r label=Fig5, echo=FALSE}
lab4 <- 'M10'
lab5 <- 'M13'

fig5 + 
  geom_text(x=10, y=c4s(10)+3, label='C-4S', colour='turquoise') +
  geom_text(x=25, y=sf.crisi.fun(25)+1, label=lab4) +
  geom_text(x=20, y=c3s(20)-1, label='C-3S', colour='purple') +
  geom_text(x=26, y=sf.crisiCon.fun(26)-1.5, label=lab5, colour='gray')+
  geom_text(x=15, y=c6s(15)+1.5, label='C-6S', colour='darkred') +
  labs(x='ISI', y='ROS (m/min)')
```

Figure 5 shows the observations and selected model predictions based on the ISI, along with certain FBP models. As indicated in Table 1, the 'aggregated' dataset models (e.g. M10) performed worse (higher MAE, MAPE, lower Efron's R-squared) than the boreal conifer-based models (e.g. M13) when using the original ISI predictor. Also evident from this figure are the overprediction tendencies of the C-6S and (especially) C-4S models, irrespective of fuel type.

## 5. Discussion

This analysis presents a summary of several decades of experimental burning in conifer stands, focusing on fires identified as surface fires by original observers. A small number of wildfires (exhibiting surface fire behaviour) were also included due to their obvious importance in representing 'high end' burning conditions (i.e., high ISI or ISI~sa~). It is apparent that as surface fires spread under more extreme conditions (high wind, lower moisture conditions), ROS begins to overlap with the range of so-called passive crown fire behaviour [Figure 1; @vanwagner1977; @cruz2005], although this will also depend on other factors such as canopy base height and surface fuel consumption [@cruz2004; @perrakis2023]. Indeed, some of the observations classed as surface fires clearly had some canopy fuel involvement, based on photographs [see, e.g., @alexander1988; @hirsch2000] and estimated crown fuel consumption; these were removed from the dataset for most model fitting. However, a few other observations, notably the two wildfires, had no information on canopy fuel involvement and were left in as surface fires. The great uncertainty associated with these data adds to the lack of clarity around ROS under high danger (i.e., high ISI or ISI~sa~) conditions. In many conifer stands, these conditions represent crown fires, reducing the need for a surface ROS model. However, as we consider the value of hazard reduction treatments, for instance, where stands with high CBH and low surface fuel loading are engineered to resist crown fire [@agee2005; @hirsch1999], there is a greater need to estimate sROS under higher danger conditions.

Although the most relevant value related to wind velocity might be the mid-flame wind speed (as per [@rothermel1972]), the 10-m open wind speed is commonly measured at fire weather stations across Canada and internationally [@lawson2008], and avoids the major challenge of in-stand wind speed modelling. We tested other associated forest structure variables, including canopy closure class, FSG, and ignition line exposure, in order to account for wind reduction between 10-m open conditions and flame-level (\~1 m) sub-canopy conditions.

While physical fire spread models attempt to represent heat transfer and combustion processes, empirical and semi-empirical models are much easier and quicker to use and learn, and therefore preferable for operational fire predictions. The FBP System initially relied on categorical fuel types. While existing fuel types remain useful constructs, selecting the best-fit fuel type can sometimes present a subjective and challenging dilemma, where structural attributes can present a conflicting picture and fail to represent observed fire behaviour [@perrakis2018a; @baron2024]. A switch to continuous fuel attributes (rather than fuel types) presents a greater range of options. For instance, black spruce stands with a higher crown base [e.g., @Thompson.etal2020; @wilkinson2018a] may support surface fire at higher danger levels than suggested by the best FBP System categorical fuel type (i.e., C-2; @forestrycanadafiredangergroup1992a). However, differentiating surface fire behaviour between specific conifer fuel types is not possible at this time. The variability in factors such as understory vegetation, shrub cover, and tree density suggest that considerable variability is expected between individual sites, in addition to between overall fuel or vegetation types (overstory and understory). Our findings suggest that boreal and sub-boreal pine and spruce fuel types can be aggregated for this purpose, provided precise prediction accuracy is not required or expected. However, this error will be compounded when surface ROS or intensity is required to predict additional fire behaviour properties, such as crown fire initiation using Van Wagner's model [@vanwagner1977; @scott2001].

#### Using final surface rate of spread models

Four models shown here stand out as superior: Models 11 and 12, for boreal/sub-boreal conifer stands, and Models 5 and 7, somewhat more fuel type independent. Models 5 and 11 use the traditional ISI measure, based on open wind speed and the FFMC, while Models 7 and 12 take advantage of the additional flexibility of the Wotton and Beverly [-@wotton2007] stand-adjusted litter moisture model and the *ISI~sa~* index introduced here. Neither overstory genus (pine vs spruce) nor stand density class variables were significant predictors of ROS in any models on their own; however, the models using *ISI~sa~* incorporate effects of stand density and DMC indirectly via their influence on fuel moisture (the mc~sa~). This is in line with findings from physical modelling studies that suggest, for instance, that thinning treatments can increase surface ROS via higher effective in-stand wind speed in more open stands [e.g., @parsons2018; @marshall2020].

The major limitation of the sROS models and dataset are the paucity of observations at higher danger conditions (ws or ISI) and the importance of various low-confidence data points. The reconstructions of various wildfires [@vanwagner1965a; @hummel1979a; @vanwagner1973b] will necessarily result in less accurate ROS observations, including estimated predictors, than those from experimental fires. While we assumed that these observations were reconstructed as accurately as possible by experienced personnel, there is no substitute for additional surface fire observations. Those spreading under high indices, necessarily with high LCBH and-or low SFC to avoid crowning, will help greatly to improve the accuracy and utility of surface ROS models. Some of the variability in the data is undoubtedly due to the varying canopy influence (including edge effects) on in-stand wind speed and turbulence, as previously discussed. These factors, potentially exacerbated by varying plot sizes, are not accounted in our models. The present sROS models appear crude, but will likely provide a useful first approximation decision support tool for fire managers based on real-world fire data. Surface ROS errors of 1-2 m min^-1^ should be expected below ISI (or ISI~sa~) 10; and larger errors of perhaps 2-5 m min^-1^ (occasionally more) may be encountered in real world use between *ISI* / *ISI~sa~* 10 and 25. Use of these models above ISI 25 involves extrapolation and should be undertaken only with great caution.

For models that include the SFC factor, the SFC influence is greatest at low ISI or ISI~sa~ levels, and appears minimal by ISI 15.

### Expected accuracy

Mean and 90th percentile overprediction vs. mean underprediction - best 4 models.

While it is perhaps unfair to compare the performance of fitted models to supposedly independently-derived models, it is apparent that the FBP-era models performed poorly. Negative values of Efron's R-squared suggest that these models perform worse than a null model using only the mean of all observations.

Finally, the '25 percent model' identifies that a rough but usable approximation of surface fire ROS in conifer stands is rapidly estimated, in m min^-1^, as one quarter of the 10-m open wind speed (in km h^-1^). The use of this model is not unlike the '10 % wind speed rule of thumb' model for crown fire spread in conifer stands [@cruz2019], where a statistically better fit is forgone in favour of a close but much more easily calculated model for operational purposes. The important distinction is the difference in units, with wind speed and ROS kept in the units typically used by Canadian fire management crews. If we held the units for wind speed and ROS constant, e.g. km h^-1^, this model works out to a '1.5 % wind speed rule', which is not as easily calculated in the field. As with all such tools, proper training is key to avoid confusion, lest personnel be misled into thinking a fire will spread much faster than this model suggests (if it were actually 25 % of the wind speed, in km h^-1^).

Under very low danger conditions (e.g., FFMC \< 75 or ISI \< 1), ignition in needle fuel substrates becomes highly unlikely [@beverly2007; @nadeem2020], so ROS is a minimal concern.

Other researchers have developed surface fire spread models usable in conifer forest litter, typically using empirical or semi-empirical approaches based on laboratory experiments[e.g., @rothermel1972; @rossa2018]. Australian models?# Log-transformation common, but seemed unhelpful with present small and variable dataset.

It is expected that the quality and quantity of source data will improve over time, allowing for periodic reanalysis and improvement of these models.

## 6. References

::: {#refs}
:::

## 7. Appendix: Final model coefficients

```{r echo=FALSE, warnings=FALSE}
#build table of coefficients for all final models in 
#acc.tab4 (including c6s, c4s, etc.)

#process model coefs from mod.list.long

#extract fitted models (not preexisting functions)
mod.list.models <- mod.list.long[1:14]

#assign model names with numbers
final.names <- as.data.frame(modnames) %>% 
  mutate(num=row_number(), 
         Model=str_c(num, '. ', modnames))

#produce tidy tables of model parameters

#tidy mod.list to create simple list object
param.list <- purrr::map(mod.list.models, tidy) 

names(param.list) <- slice(final.names, 1:14) %>% 
  pull(Model)

#change list to data frame
mod.params.df <- bind_rows(param.list, .id='Model') %>%
  rename(Term=term, Estimate=estimate, Stat=statistic) %>%
  mutate(Model=if_else(Model==lag(Model), '.', Model)) 
  #if name is same as previous, just write a dot .
mod.params.df$Model[1] <- names(param.list)[[1]] #fix first name

print(mod.params.df, n=nrow(mod.params.df))
         
  

```
